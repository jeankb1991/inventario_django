{% extends "painel/base.html" %}
{% load static %}

{% block content %}
<h2 class="mb-4">Itens</h2>

<form method="GET" class="row g-2 mb-4">

  <div class="col-auto">
    <input name="q" value="{{ q }}" class="form-control" placeholder="Buscar nome...">
  </div>

  <div class="col-auto">
    <select name="category" class="form-select">
      <option value="">Todas categorias</option>
      {% for c in categories %}
        <option value="{{ c.id }}" {% if c.id|stringformat:"s" == cat %}selected{% endif %}>
          {{ c.name }}
        </option>
      {% endfor %}
    </select>
  </div>

  <div class="col-auto">
    <label class="form-check mt-2">
      <input type="checkbox" name="low" value="1"
        {% if low == '1' %}checked{% endif %} />
      Estoque baixo
    </label>
  </div>

  <div class="col-auto">
    <button class="btn btn-primary">Filtrar</button>
  </div>

  <div class="col-auto">
    <a href="{% url 'item-add' %}" class="btn btn-success">+ Novo Item</a>
  </div>

</form>

<table class="table table-hover table-bordered bg-white shadow-sm">
  <thead class="table-light">
    <tr>
      <th>ID</th>
      <th>Nome</th>
      <th>Categoria</th>
      <th>Quantidade</th>
      <th>Imagem</th>
      <th width="180">Ações</th>
    </tr>
  </thead>

  <tbody>
    {% for i in items %}
      <tr>
        <td>{{ i.id }}</td>
        <td>{{ i.name }}</td>
        <td>{{ i.category.name }}</td>
        <td>
          {% if i.quantity <= i.min_quantity %}
            <span class="badge bg-danger">{{ i.quantity }}</span>
          {% else %}
            <span class="badge bg-primary">{{ i.quantity }}</span>
          {% endif %}
        </td>

        <td>
          {% if i.image %}
            <img src="{{ i.image.url }}" style="width:60px;height:60px;object-fit:cover;" class="rounded">
          {% else %}
            <span class="text-muted">Sem imagem</span>
          {% endif %}
        </td>

        <td>
          <a href="{% url 'item-edit' i.id %}" class="btn btn-sm btn-warning">Editar</a>
          <a href="{% url 'item-delete' i.id %}" class="btn btn-sm btn-danger"
             onclick="return confirm('Deseja excluir este item?')">Excluir</a>
        </td>
      </tr>
    {% empty %}
      <tr>
        <td colspan="6" class="text-center text-muted">Nenhum item encontrado.</td>
      </tr>
    {% endfor %}
  </tbody>
</table>

<!-- Paginação -->
<nav class="mt-4">
  <ul class="pagination justify-content-center">
    {% if items.has_previous %}
      <li class="page-item"><a class="page-link" href="?page={{ items.previous_page_number }}">Anterior</a></li>
    {% else %}
      <li class="page-item disabled"><span class="page-link">Anterior</span></li>
    {% endif %}

    <li class="page-item disabled"><span class="page-link">
      Página {{ items.number }} de {{ items.paginator.num_pages }}
    </span></li>

    {% if items.has_next %}
      <li class="page-item"><a class="page-link" href="?page={{ items.next_page_number }}">Próxima</a></li>
    {% else %}
      <li class="page-item disabled"><span class="page-link">Próxima</span></li>
    {% endif %}
  </ul>
</nav>

{% endblock %}
